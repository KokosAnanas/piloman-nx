# Реестр сварных соединений — пилотный проект на Nx (Angular 21 + NestJS + MongoDB)

Этот репозиторий содержит минимальный вертикальный срез домена **«реестр сварных соединений»** на базе монорепозитория [Nx](https://nx.dev). Проект реализован как монорепо с использованием `pnpm` и включает два приложения и несколько библиотек:

- **`apps/web`** — фронтенд на Angular 21 (standalone, Vite). Отображает таблицу реестра, позволяет добавлять, редактировать и удалять записи с помощью PrimeNG.
- **`apps/api`** — backend на NestJS, предоставляющий REST‑API для CRUD‑операций и подключение к MongoDB через Mongoose.
- **`libs/welds/models`** — общие типы и DTO для сущности **`Weld`** (стык/шов). Используются и на сервере, и на клиенте.
- **`libs/welds/data‑access`** — Angular‑клиент для обращения к API (служба `WeldsApiService`).
- **`libs/welds/feature‑welds`** — standalone‑страница/компонент «Реестр сварных соединений» для фронтенда.

## Возможности

- Создание, просмотр, обновление и удаление сварных соединений.
- Поиск по номеру стыка (`?search=`) в REST‑API.
- Гибкое отображение колонок, inline‑форма добавления и подтверждение удаления записей.
- Типизация и валидация с помощью `class-validator` на сервере и реактивных форм на клиенте.
- Монорепозиторная архитектура Nx, позволяющая разделять бизнес‑логику домена по библиотекам и переиспользовать код.

## Требования

Для работы проекта понадобятся:

- [Node.js 18 или выше](https://nodejs.org/);
- [pnpm](https://pnpm.io/) (пакетный менеджер для монорепо);
- [MongoDB](https://www.mongodb.com/) — локальный или удалённый экземпляр.

## Установка

1. Склонируйте репозиторий и установите зависимости:

   ```bash
   git clone https://github.com/KokosAnanas/piloman-nx.git
   cd piloman-nx
   pnpm install
   ```

2. Настройте подключение к MongoDB. По умолчанию API пытается подключиться к `mongodb://localhost:27017/piloman`. URI можно переопределить через переменную окружения `MONGODB_URI`:

   ```bash
   export MONGODB_URI="mongodb://<пользователь>:<пароль>@localhost:27017/piloman"
   ```

## Запуск

В режиме разработки можно поднять оба приложения параллельно:

```bash
pnpm start        # запустит api и web
```

или отдельно:

```bash
pnpm start:api    # NestJS API на http://localhost:3000/api
pnpm start:web    # Angular SPA на http://localhost:4200
```

После запуска откройте браузер и перейдите по адресу [`http://localhost:4200/welds`](http://localhost:4200/welds), чтобы увидеть таблицу реестра.

### API эндпоинты

Backend сервирует API с префиксом `/api`:

- `GET    /api/welds`     — список сварных соединений (поддерживает параметр `?search=`);
- `GET    /api/welds/:id` — получение соединения по ID;
- `POST   /api/welds`     — создание нового Weld;
- `PATCH  /api/welds/:id` — обновление существующего;
- `DELETE /api/welds/:id` — удаление.

## Структура каталогов

```
apps/
  api/          # NestJS приложение
  web/          # Angular приложение
libs/
  welds/
    models/        # типы и DTO (domain model)
    data-access/   # Angular сервис для API
    feature-welds/ # компонент/страница реестра
```

Каждая библиотека имеет публичный API (`src/index.ts`) и отмечена тегами Nx (`scope:welds,type:*`) для контроля импортов. Бизнес‑логика домена живёт в `libs/welds/*` и не помещается в `apps/web` или `apps/api`.

## Разработка и вклад

Вы можете расширять функциональность, следуя рекомендациям Nx, Angular и NestJS. При добавлении новых доменов создавайте аналогичные библиотеки `libs/<домен>/models`, `libs/<домен>/data-access`, `libs/<домен>/feature-<домен>` и подключайте их через публичные API. Перед отправкой изменений убедитесь, что все тесты проходят:

```bash
pnpm nx test <project>
```

и код соответствует стилю ESLint/Prettier:

```bash
pnpm nx lint <project>
```

Pull‑requests приветствуются!

